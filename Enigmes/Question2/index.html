<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√ânigme - Question 2</title>
  <link rel="stylesheet" href="../../global.css">
  <link rel="preload" as="image" href="wokvide.png">
  <link rel="preload" as="image" href="cacahueteair.png">
  <link rel="preload" as="image" href="cacahuetewok.png">
  <link rel="preload" as="image" href="patederizair.png">
  <link rel="preload" as="image" href="patederizchute.png">
  <link rel="preload" as="image" href="patederizwok.png">
  <link rel="preload" as="image" href="cibouletteair.png">
  <link rel="preload" as="image" href="ciboulettewok.png">
  <link rel="preload" as="image" href="sojaair.png">
  <link rel="preload" as="image" href="sojawok.png">
  <link rel="preload" as="image" href="oeufair.png">
  <link rel="preload" as="image" href="oeufwok.png">
  <link rel="preload" as="image" href="viandair.png">
  <link rel="preload" as="image" href="viandechute.png">
  <link rel="preload" as="image" href="viandewok.png">
  <link rel="preload" as="image" href="padthai.png">
  <style>
    body {
      background-color: #1a0d0f;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    }

	.ronflex-bulle {
	  position: absolute;
	  top: 200px;
	  left: calc(50% + 170px);
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	  padding-left: 15%;
	}

    .ronflex-bulle img {
      width: 220px;
      height: auto;
      border: none;
    }

    .bulle-texte {
      margin-top: 5px;
      background-color: #4b2b36;
      border-radius: 12px;
      padding: 10px 14px;
      max-width: 200px;
      font-size: 0.95rem;
      position: relative;
      color: #ffcccc;
    }

    .bulle-texte::before {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 30px;
      width: 0;
      height: 0;
      border: 10px solid transparent;
      border-top-color: #4b2b36;
    }

    .hint-image {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 340px;
      z-index: 2;
    }

    .hint-image img {
      width: 100%;
    }

    .hint-letters {
      position: absolute;
      top: 44px;
      left: 50%;
      transform: translateX(-50%);
      width: 88%;
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      row-gap: 6px;
      justify-items: center;
      font-family: monospace;
      font-size: 1.4rem;
      font-weight: bold;
      color: #000;
      z-index: 3;
    }

    .letter-slot {
      width: 1.2rem;
      text-align: center;
    }

    #animImage {
      width: 300px;
      height: auto;
      display: block;
      margin: 20px auto 20px auto;
      image-rendering: pixelated;
      border-radius: 12px;
    }

    .ingredients-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
    }

    .ingredient-btn {
      cursor: pointer;
      width: 90px;
      height: 90px;
      padding: 6px;
      background-color: #2e1214;
      border: 2px solid white;
      border-radius: 10px;
    }

    .selected {
      border: 2px solid white !important;
    }

    .question-box {
      max-width: 720px;
      margin: 30px auto 20px auto;
      background-color: #2e1214;
      padding: 30px;
      border: 1px solid #8a2be2;
      border-radius: 16px;
    }

    .message {
      margin-top: 30px;
      font-size: 1.8rem;
      color: #ff66cc;
    }

    .code-fragment, .next-button {
      margin-top: 20px;
    }

    .next-button a, .cook-button {
      padding: 10px 20px;
      background-color: red;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      margin-top: 20px;
      display: inline-block;
    }
@media (max-width: 768px) {
  .image-wrapper,
  .bonus-flex-wrapper {
    flex-direction: column;
    align-items: center;
    padding-left: 0;
    gap: 20px;
  }

  .image-wrapper > .question-image {
    order: -2;
  }

  .image-wrapper > .ronflex-bulle {
    order: 2;
  }

  .bonus-flex-wrapper > img {
    order: -2;
  }

  .basket-bulle {
    order: 2;
  }

  .question-image,
  .ronflex-bulle img,
  .basket-bulle img {
    width: 80%;
    max-width: 300px;
  }

  .ronflex-bulle,
  .basket-bulle {
    width: auto;
  }

  .hint-image,
  .bonus-wrapper {
    position: static;
    width: 90%;
    max-width: 320px;
    margin: 20px auto;
  }

  .hint-letters {
    top: 50px;
    left: 50%;
    transform: translateX(-50%);
    width: 50%;
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    row-gap: 6px;
    justify-items: center;
    font-family: monospace;
    font-size: 1.4rem;
    font-weight: bold;
    color: #000;
  }

  .bonus-letters {
    position: absolute;
    top: 688px;
    left: 65.5%;
    transform: translateX(-50%);
    display: flex;
    justify-content: center;
    gap: 4px;
    font-family: monospace;
    font-size: 1.4rem;
    font-weight: bold;
    color: #000;
    width: 100px;
    pointer-events: none;
  }
}
  </style>
</head>
<body>
  <div class="hint-image">
    <img src="pancarte_tiplouf.png" alt="Mot de passe √† reconstituer">
    <div class="hint-letters" id="hintLetters"></div>
  </div>

  <h2 id="titreQuestion" style="margin-top: 130px">üçú Construis ton Pad Tha√Ø parfait !</h2>
  <img id="animImage" src="wokvide.png" alt="Animation Pad Tha√Ø" />

  <div class="ronflex-bulle" id="ronflex">
    <img src="prof.png" alt="Prof">
    <div class="bulle-texte">S'il n'y a pas d'animation, l'aliment est mauvais !</div>
  </div>

  <div class="question-box" id="questionBox">
    <div class="ingredients-row" id="ingredientsRow">
      <img class="ingredient-btn" src="cacahuete.png" alt="Cacahu√®tes" data-frames='["wokvide.png","cacahueteair.png","cacahuetewok.png","wokvide.png"]' />
      <img class="ingredient-btn" src="patederiz.png" alt="P√¢tes de riz" data-frames='["wokvide.png","patederizair.png","patederizchute.png","patederizwok.png","wokvide.png"]' />
      <img class="ingredient-btn" src="poussesoja.png" alt="Pousses de soja" />
      <img class="ingredient-btn" src="ciboulette.png" alt="Ciboulette" data-frames='["wokvide.png","cibouletteair.png","ciboulettewok.png","wokvide.png"]' />
      <img class="ingredient-btn" src="soja.png" alt="Sauce Soja" data-frames='["wokvide.png","sojaair.png","sojawok.png","wokvide.png"]' />
      <img class="ingredient-btn" src="oeuf.png" alt="≈íuf" data-frames='["wokvide.png","oeufair.png","oeufwok.png","wokvide.png"]' />
      <img class="ingredient-btn" src="viande.png" alt="Viande" data-frames='["wokvide.png","viandair.png","viandechute.png","viandewok.png","wokvide.png"]' />
    </div>
    <button class="cook-button" id="cookBtn">üî• Faire sauter</button>
  </div>

  <div class="message" id="message"></div>
  <div class="code-fragment" id="code-fragment"></div>
  <div class="next-button" id="next"></div>

<script>
  const motDePasse = "JOYEUXANNIVERSAIRECHOU<3".split("");
  const bonnesReponses = [
    "≈íuf", "Viande", "Sauce Soja", "P√¢tes de riz", "Ciboulette", "Cacahu√®tes"
  ];

  const lettresRevelees = JSON.parse(localStorage.getItem("lettresRevelees") || "[]");
  while (lettresRevelees.length < motDePasse.length) lettresRevelees.push("_");

  const hintLettersDiv = document.getElementById("hintLetters");
  const animImage = document.getElementById("animImage");
  const message = document.getElementById("message");
  const codeFragment = document.getElementById("code-fragment");
  const nextDiv = document.getElementById("next");
  const cookBtn = document.getElementById("cookBtn");
  const title = document.getElementById("titreQuestion");
  const ronflex = document.getElementById("ronflex");
  const box = document.getElementById("questionBox");

  function renderMotDePasse() {
    hintLettersDiv.innerHTML = "";
    lettresRevelees.forEach((lettre, i) => {
      const span = document.createElement("span");
      span.className = "letter-slot";
      span.id = "lettre-" + i;
      span.textContent = lettre;
      hintLettersDiv.appendChild(span);
    });
  }

  renderMotDePasse();

  let questionValidee = localStorage.getItem("question2_validee") === "true";
  const clicsValides = new Set();

  if (questionValidee) {
    afficherSucces();
  }

  const buttons = document.querySelectorAll(".ingredient-btn");

  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      const frames = JSON.parse(btn.dataset.frames || "[]");
      const nom = btn.alt;

      if (nom === "Pousses de soja") {
        clicsValides.clear();
        buttons.forEach(b => b.classList.remove("selected"));
        return;
      }

      if (bonnesReponses.includes(nom)) {
        btn.classList.add("selected");
        clicsValides.add(nom);
      }

      if (frames.length > 0) {
        let i = 0;
        const delay = 250;
        function jouerFrame() {
          animImage.src = frames[i];
          i++;
          if (i < frames.length) setTimeout(jouerFrame, delay);
        }
        jouerFrame();
      }
    });
  });

  cookBtn.addEventListener("click", () => {
    if (questionValidee) return;
    if (clicsValides.size === bonnesReponses.length) {
      validerQuestion();
    } else {
      message.textContent = "Hmm... Tu as peut-√™tre oubli√© un ingr√©dient ? üçú";
    }
  });

  function validerQuestion() {
    const indicesDispo = lettresRevelees.map((l, i) => l === "_" ? i : null).filter(i => i !== null);
    const index = indicesDispo[Math.floor(Math.random() * indicesDispo.length)];
    const lettre = motDePasse[index];
    lettresRevelees[index] = lettre;

    localStorage.setItem("lettresRevelees", JSON.stringify(lettresRevelees));
    localStorage.setItem("question2_validee", "true");
    document.getElementById("lettre-" + index).textContent = lettre;
    afficherSucces(lettre);
  }

  function afficherSucces(lettre) {
    message.innerHTML = "<strong style='color:#ff66cc;'>üçú Bon app√©tit !</strong>";
    const index = lettresRevelees.findIndex((l, i) => document.getElementById("lettre-" + i).textContent === lettre);
    document.getElementById("lettre-" + index).textContent = lettre;
    codeFragment.innerHTML = `<br>Voici ta partie de code : <code>${lettre}</code>`;
    nextDiv.innerHTML = `<a href='../Question3/index.html'>Passer √† la question suivante</a>`;

    document.getElementById("animImage").src = "padthai.png";
    document.getElementById("animImage").style.width = "340px";
    box.style.display = "none";
    ronflex.style.display = "none";
    title.style.display = "none";
  }
</script>
</body>
</html>
